<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>í†µê³„ ëŒ€ì‹œë³´ë“œ</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; padding: 30px; background: #f0f4f8; color: #333; }
    h1 { font-size: 28px; margin-bottom: 10px; }
    h2 { margin-top: 40px; }
    h3 { margin-top: 20px; font-size: 20px; }
    .summary { font-size: 18px; margin-bottom: 20px; }
    .online { font-weight: bold; color: green; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; background: white; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background-color: #f9f9f9; }
  </style>
</head>
<body>

  <h1>ğŸ“Š ì‹¤ì‹œê°„ í†µê³„ ëŒ€ì‹œë³´ë“œ</h1>
  <div class="summary">
    ğŸ”„ í˜„ì¬ ì ‘ì† ì¤‘ì¸ ì‚¬ìš©ì: <span class="online" id="online-count">-</span>ëª…<br>
    âœ… ì´ ë°©ë¬¸ì: <b id="total-visits">-</b> / ì´ í´ë¦­: <b id="total-clicks">-</b>
  </div>

  <div id="tables">ë¡œë”© ì¤‘...</div>
  <div id="click-logs">ë¡œë”© ì¤‘...</div>

  <script>
    function loadStats() {
      fetch("https://anan14.onrender.com/api/stats")
        .then(res => res.json())
        .then(data => {
          console.log("ğŸ“¦ ì „ì²´ í†µê³„ ë°ì´í„°:", data);

          let totalVisits = 0;
          let totalClicks = 0;
          let html = "";

          for (const date in data.visits) {
            html += `<h2>${date}</h2><table><tr><th>ì‹œê°„</th><th>ë°©ë¬¸ì</th><th>í´ë¦­ìˆ˜</th></tr>`;
            const hours = data.visits[date];
            for (const hour in hours) {
              const v = hours[hour] || 0;
              const c = (data.clicks[date] && data.clicks[date][hour]) || 0;
              totalVisits += v;
              totalClicks += c;
              html += `<tr><td>${hour}</td><td>${v}</td><td>${c}</td></tr>`;
            }
            html += "</table>";
          }

          document.getElementById("tables").innerHTML = html;
          document.getElementById("total-visits").innerText = totalVisits;
          document.getElementById("total-clicks").innerText = totalClicks;

          // ğŸ” í´ë¦­ ë¡œê·¸ ì „ì²´ ë‚ ì§œ ì¶œë ¥
          let logHTML = "<h2>ğŸ•’ í´ë¦­ ë¡œê·¸</h2>";
          for (const date in data.clickLogs || {}) {
            logHTML += `<h3>${date}</h3><table><tr><th>ì‹œê°„</th><th>UDD</th></tr>`;
            const logs = data.clickLogs[date];
            for (let i = logs.length - 1; i >= 0; i--) {
              const log = logs[i];
              logHTML += `<tr><td>${log.time}</td><td>${log.udd}</td></tr>`;
            }
            logHTML += "</table>";
          }
          document.getElementById("click-logs").innerHTML = logHTML;
        });
    }

    function loadOnline() {
      fetch("https://anan14.onrender.com/api/online-count")
        .then(res => res.json())
        .then(data => {
          document.getElementById("online-count").innerText = data.count;
        });
    }

    function autoUpdate() {
      loadStats();
      loadOnline();
    }

    autoUpdate();
    setInterval(autoUpdate, 5000);
  </script>

</body>
</html>
